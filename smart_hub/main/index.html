<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Hub HQ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        html,body {margin:0;padding:0;font-family:sans-serif;background:#171923;color:#fff;}
        header {background: #20223a; padding: 1rem; display: flex; align-items: center; gap: .7rem;}
        .logo { width: 2.2rem; height:2.2rem; }
        h1 { font-size: 1.6rem; margin:0; letter-spacing:.05em;}
        main { padding: 2rem; max-width: 720px; margin: auto;}
        .devices { display: grid; gap: 1.3rem; grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));}
        .device {background: #242547; border-radius: 18px; padding: 1rem; box-shadow:0 2px 12px #0003; transition:.2s; cursor:pointer;}
        .device:hover { background: #313364; transform: translateY(-4px) scale(1.02);}
        .device svg { width:2.2em; height:2.2em; display:block; margin-bottom:.6em;}
        .devname { font-weight:600; font-size:1.1em;}
        .status { font-size:.9em; color:#a5a5b8;}
        .proto { font-size:.8em; color:#68d391; margin-top:0.3em;}
        @media (max-width:600px) { main {padding:.8rem;} }
        button {margin-top:.7em; border: none; padding:.4em 1.1em; border-radius:1em; font-size:1em; background:#68d391;color:#171923;font-weight:700; cursor:pointer;transition:.2s;}
        button:hover { background:#48bb78;}
    </style>
</head>
<body>
    <header>
        <svg class="logo" viewBox="0 0 32 32" fill="none"><circle cx="16" cy="16" r="15" stroke="#68d391" stroke-width="2"/><rect x="10" y="10" width="12" height="12" rx="3" fill="#68d391" fill-opacity=".3"/></svg>
        <h1>Smart Hub HQ</h1>
    </header>
    <main>
        <h2 style="font-weight:400;margin-bottom:2em;">Devices discovered in your network:</h2>
        <div class="devices" id="devices"></div>
    </main>
    <script>
        async function fetchDevices() {
            try {
                const resp = await fetch('/api/devices');
                const devices = await resp.json();
                let html = '';
                for (const dev of devices) {
                    html += `<div class="device" onclick="toggleDevice('${dev.id}')">
                        <svg>${getDeviceIcon(dev.type)}</svg>
                        <div class="devname">${dev.name}</div>
                        <div class="status">${capitalize(dev.status)}</div>
                        <div class="proto">${dev.proto.toUpperCase()}</div>
                        <button>${dev.status === 'on' ? 'Turn OFF' : 'Turn ON'}</button>
                    </div>`;
                }
                document.getElementById('devices').innerHTML = html;
            } catch (e) {
                document.getElementById('devices').innerHTML = "<div style='color:red'>No connection to hub...</div>";
            }
        }
        function getDeviceIcon(type) {
            switch(type) {
                case 'light': return `<circle cx="16" cy="16" r="10" fill="#f6e05e"/>`;
                case 'plug': return `<rect x="8" y="12" width="16" height="8" rx="4" fill="#805ad5"/>`;
                case 'sensor': return `<ellipse cx="16" cy="16" rx="10" ry="6" fill="#68d391"/>`;
                case 'tv': return `<rect x="8" y="10" width="16" height="12" rx="3" fill="#63b3ed"/><rect x="12" y="22" width="8" height="2" rx="1" fill="#fff"/>`;
                case 'media': return `<circle cx="16" cy="16" r="9" fill="#f687b3"/><polygon points="14,12 22,16 14,20" fill="#fff"/>`;
                case 'apple': return `<ellipse cx="16" cy="16" rx="10" ry="8" fill="#fff" fill-opacity="0.9"/><circle cx="16" cy="10" r="2" fill="#68d391"/>`;
                default: return `<circle cx="16" cy="16" r="10" fill="#a0aec0"/>`;
            }
        }
        function capitalize(str) {
            return str ? str[0].toUpperCase() + str.slice(1) : '';
        }
        async function toggleDevice(id) {
            await fetch(`/api/devices/${id}/toggle`, {method:'POST'});
            setTimeout(fetchDevices, 400);
        }
        fetchDevices();
        setInterval(fetchDevices, 6000);
    </script>
</body>
</html>
